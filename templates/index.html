{% extends "base.html" %}

{% block content %}
    <h2>Dashboard Overview</h2>
    
            <!-- Stats Cards - SIMPLE COLORS (UNCLICKABLE) -->
    <div class="stats-grid">
        <!-- Row 1: 4 cards -->
        <div class="stat-card" style="background: #3498db; color: white;">
            <h3>ğŸ‘¥ Total Faculty</h3>
            <div class="stat-number" style="color: white;">{{ total_faculty }}</div>
        </div>
        
        <div class="stat-card" style="background: #27ae60; color: white;">
            <h3>âœ… Regular Faculty</h3>
            <div class="stat-number" style="color: white;">{{ regular_faculty }}</div>
        </div>
        
        <div class="stat-card" style="background: #e74c3c; color: white;">
            <h3>ğŸ“ Ph.D Holders</h3>
            <div class="stat-number" style="color: white;">{{ phd_count }}</div>
        </div>
        
        <div class="stat-card" style="background: #9b59b6; color: white;">
            <h3>ğŸ“œ Post Graduates</h3>
            <div class="stat-number" style="color: white;">{{ pg_count }}</div>
        </div>
    </div>

    <div class="stats-grid" style="margin-top: 20px;">
        <!-- Row 2: 3 cards -->
        <div class="stat-card" style="background: #f39c12; color: white;">
            <h3>ğŸ‘¨â€ğŸ« Professors</h3>
            <div class="stat-number" style="color: white;">{{ professor_count }}</div>
        </div>
        
        <div class="stat-card" style="background: #1abc9c; color: white;">
            <h3>ğŸ‘¨â€ğŸ’¼ Associate Professors</h3>
            <div class="stat-number" style="color: white;">{{ associate_professor_count }}</div>
        </div>
        
        <div class="stat-card" style="background: #34495e; color: white;">
            <h3>ğŸ‘¨â€ğŸ“ Assistant Professors</h3>
            <div class="stat-number" style="color: white;">{{ assistant_professor_count }}</div>
        </div>
    </div>
            <!-- R&D Publications Statistics - ONLY for IQAC and Office -->
    {% if session.role in ['IQAC', 'Office', 'admin', 'editor', 'Admin', 'Editor'] %}
    <div class="stats-grid" style="margin-top: 20px;">
        <div class="stat-card" style="background: #e74c3c; color: white;">
            <h3>ğŸ“š Journal Publications</h3>
            <div class="stat-number" style="color: white;">{{ journal_count }}</div>
        </div>
        
        <div class="stat-card" style="background: #3498db; color: white;">
            <h3>ğŸ¤ Conference Papers</h3>
            <div class="stat-number" style="color: white;">{{ conference_count }}</div>
        </div>
        
        <div class="stat-card" style="background: #9b59b6; color: white;">
            <h3>ğŸ“– Book Chapters</h3>
            <div class="stat-number" style="color: white;">{{ book_chapter_count }}</div>
        </div>
        
        <div class="stat-card" style="background: #f39c12; color: white;">
            <h3>ğŸ“š Books</h3>
            <div class="stat-number" style="color: white;">{{ book_count }}</div>
        </div>
        
        <div class="stat-card" style="background: #16a085; color: white;">
            <h3>âš–ï¸ Patents</h3>
            <div class="stat-number" style="color: white;">{{ patent_count }}</div>
        </div>
    </div>
    
    <!-- Total Publications Card -->
    <div style="text-align: center; margin: 20px 0;">
        <div class="stat-card" style="background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; max-width: 300px; margin: 0 auto;">
            <h3>ğŸ“Š Total R&D Publications</h3>
            <div class="stat-number" style="color: white; font-size: 2.8rem;">{{ total_publications }}</div>
        </div>
    </div>
    {% endif %}
    <!-- Statistics Sections -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        
       <!-- Designation Statistics -->
<!-- Designation Statistics -->
<div class="card">
    <h3>ğŸ“Š Designation Distribution</h3>
    {% if designation_stats %}
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 15px;">
            {% for desig_stat in designation_stats %}
            <a href="/designation/{{ desig_stat.designation|urlencode }}" 
               style="text-decoration: none; display: block;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                           color: white; padding: 20px; border-radius: 10px; 
                           transition: all 0.3s ease; border: 2px solid transparent;"
                     onmouseover="this.style.transform='translateY(-5px)'; this.style.borderColor='#3498db';" 
                     onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='transparent';">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 18px; font-weight: bold; margin-bottom: 5px;">
                                {% if desig_stat.designation == 'Professor' %}ğŸ‘¨â€ğŸ« Professor
                                {% elif desig_stat.designation == 'Associate Professor' %}ğŸ‘¨â€ğŸ’¼ Associate Professor
                                {% elif desig_stat.designation == 'Assistant Professor' %}ğŸ‘¨â€ğŸ“ Assistant Professor
                                {% else %}ğŸ’¼ {{ desig_stat.designation }}
                                {% endif %}
                            </div>
                            <div style="font-size: 14px; opacity: 0.9;">
                                {{ desig_stat.count }} faculty member{% if desig_stat.count != 1 %}s{% endif %}
                            </div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 8px 12px; border-radius: 20px; font-size: 16px; font-weight: bold;">
                            ğŸ‘‰
                        </div>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 40px; color: #7f8c8d;">
            <h3>No Designations Found</h3>
            <p>Start by adding faculty members to create designations.</p>
            <a href="/add_faculty" class="btn" style="background: #3498db; margin-top: 15px;">Add First Faculty</a>
        </div>
    {% endif %}
</div>
        <!-- Gender Statistics -->
        <!-- Gender Statistics - DISPLAY ONLY -->
<div class="card">
    <h3>ğŸ‘¥ Gender Distribution</h3>
    {% if gender_stats %}
        <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 15px;">
            {% for gender_stat in gender_stats %}
            <div style="background: 
                    {% if gender_stat.gender == 'M' %}#3498db
                    {% elif gender_stat.gender == 'F' %}#e74c3c
                    {% else %}#9b59b6{% endif %}; 
                color: white; padding: 20px 25px; border-radius: 10px; text-align: center;
                min-width: 140px; border: 2px solid transparent;">
                <div style="font-size: 24px; margin-bottom: 10px;">
                    {% if gender_stat.gender == 'M' %}ğŸ‘¨
                    {% elif gender_stat.gender == 'F' %}ğŸ‘©
                    {% else %}âš§{% endif %}
                </div>
                <div style="font-size: 16px; font-weight: bold; margin-bottom: 5px;">
                    {% if gender_stat.gender == 'M' %}Male
                    {% elif gender_stat.gender == 'F' %}Female
                    {% else %}Other
                    {% endif %}
                </div>
                <div style="font-size: 28px; font-weight: bold; margin-bottom: 5px;">
                    {{ gender_stat.count }}
                </div>
                <div style="font-size: 11px; opacity: 0.9;">
                    faculty member{% if gender_stat.count != 1 %}s{% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 40px; color: #7f8c8d;">
            <h3>No Gender Data Available</h3>
            <p>Start by adding faculty members to see gender distribution.</p>
            {% if session.role in ['IQAC', 'Office', 'admin', 'editor', 'Admin', 'Editor'] %}
            <a href="/add_faculty" class="btn" style="background: #3498db; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; margin-top: 10px;">Add First Faculty</a>
            {% endif %}
        </div>
    {% endif %}
</div>

    <!-- Appointment Type Statistics - WITH ICONS -->
<div class="card" style="margin-top: 20px;">
    <h3>ğŸ¯ Appointment Types</h3>
    {% if appointment_stats %}
        <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 15px;">
            {% for app_stat in appointment_stats %}
            <a href="/faculty?appointment_type={{ app_stat.appointment_type|urlencode }}" 
               style="text-decoration: none; display: block;"
               title="Click to view all {{ app_stat.appointment_type }} faculty">
                <div style="background: 
                    {% if app_stat.appointment_type == 'Regular' %}#27ae60
                    {% elif app_stat.appointment_type == 'Visiting' %}#3498db
                    {% elif app_stat.appointment_type == 'Adhoc' %}#f39c12
                    {% else %}#7f8c8d{% endif %}; 
                    color: white; padding: 20px 25px; border-radius: 10px; text-align: center;
                    transition: all 0.3s ease; border: 2px solid transparent; min-width: 140px;"
                     onmouseover="this.style.transform='translateY(-5px)'; this.style.borderColor='#3498db'; this.style.boxShadow='0 5px 15px rgba(0,0,0,0.2)';" 
                     onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='transparent'; this.style.boxShadow='none';">
                    <div style="font-size: 24px; margin-bottom: 10px;">
                        {% if app_stat.appointment_type == 'Regular' %}âœ…
                        {% elif app_stat.appointment_type == 'Visiting' %}ğŸ‘¨â€ğŸ«
                        {% elif app_stat.appointment_type == 'Adhoc' %}ğŸ“‹
                        {% else %}ğŸ‘¥{% endif %}
                    </div>
                    <div style="font-size: 16px; font-weight: bold; margin-bottom: 5px;">
                        {{ app_stat.appointment_type }}
                    </div>
                    <div style="font-size: 28px; font-weight: bold; margin-bottom: 5px;">
                        {{ app_stat.count }}
                    </div>
                    <div style="font-size: 11px; opacity: 0.9;">
                        faculty member{% if app_stat.count != 1 %}s{% endif %}
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    {% else %}
        <p style="color: #7f8c8d; text-align: center; padding: 20px;">No appointment type data available</p>
    {% endif %}
</div>

<!-- Experience Statistics -->
<div class="card" style="margin-top: 20px;">
    <h3>ğŸ“ˆ Experience Distribution</h3>
    {% if experience_stats %}
        <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 15px;">
            <!-- 0-5 Years Card -->
            <a href="/faculty?exp_from=0&exp_to=5.9" 
               style="text-decoration: none; display: block;"
               title="Click to view all 0-5 years experience faculty (up to 5.9 years)">
                <div style="background: #e74c3c; color: white; padding: 20px 25px; border-radius: 10px; text-align: center; transition: all 0.3s ease; border: 2px solid transparent; min-width: 140px;"
                     onmouseover="this.style.transform='translateY(-5px)'; this.style.borderColor='#3498db'; this.style.boxShadow='0 5px 15px rgba(0,0,0,0.2)';" 
                     onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='transparent'; this.style.boxShadow='none';">
                    <div style="font-size: 24px; margin-bottom: 10px;">ğŸŸ¥</div>
                    <div style="font-size: 16px; font-weight: bold; margin-bottom: 5px;">0-5 Years</div>
                    <div style="font-size: 28px; font-weight: bold; margin-bottom: 5px;">
                        {% for exp_stat in experience_stats %}{% if exp_stat.experience_category == '0-5' %}{{ exp_stat.count }}{% endif %}{% endfor %}
                    </div>
                    <div style="font-size: 11px; opacity: 0.9;">up to 5.9 years</div>
                </div>
            </a>
            
            <!-- 6-10 Years Card -->
            <a href="/faculty?exp_from=6&exp_to=10.9" 
               style="text-decoration: none; display: block;"
               title="Click to view all 6-10 years experience faculty (up to 10.9 years)">
                <div style="background: #f39c12; color: white; padding: 20px 25px; border-radius: 10px; text-align: center; transition: all 0.3s ease; border: 2px solid transparent; min-width: 140px;"
                     onmouseover="this.style.transform='translateY(-5px)'; this.style.borderColor='#3498db'; this.style.boxShadow='0 5px 15px rgba(0,0,0,0.2)';" 
                     onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='transparent'; this.style.boxShadow='none';">
                    <div style="font-size: 24px; margin-bottom: 10px;">ğŸŸ¨</div>
                    <div style="font-size: 16px; font-weight: bold; margin-bottom: 5px;">6-10 Years</div>
                    <div style="font-size: 28px; font-weight: bold; margin-bottom: 5px;">
                        {% for exp_stat in experience_stats %}{% if exp_stat.experience_category == '6-10' %}{{ exp_stat.count }}{% endif %}{% endfor %}
                    </div>
                    <div style="font-size: 11px; opacity: 0.9;">up to 10.9 years</div>
                </div>
            </a>
            
            <!-- 10+ Years Card -->
            <a href="/faculty?exp_from=11&exp_to=100" 
               style="text-decoration: none; display: block;"
               title="Click to view all 10+ years experience faculty">
                <div style="background: #27ae60; color: white; padding: 20px 25px; border-radius: 10px; text-align: center; transition: all 0.3s ease; border: 2px solid transparent; min-width: 140px;"
                     onmouseover="this.style.transform='translateY(-5px)'; this.style.borderColor='#3498db'; this.style.boxShadow='0 5px 15px rgba(0,0,0,0.2)';" 
                     onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='transparent'; this.style.boxShadow='none';">
                    <div style="font-size: 24px; margin-bottom: 10px;">ğŸŸ©</div>
                    <div style="font-size: 16px; font-weight: bold; margin-bottom: 5px;">10+ Years</div>
                    <div style="font-size: 28px; font-weight: bold; margin-bottom: 5px;">
                        {% for exp_stat in experience_stats %}{% if exp_stat.experience_category == '10+' %}{{ exp_stat.count }}{% endif %}{% endfor %}
                    </div>
                    <div style="font-size: 11px; opacity: 0.9;">above 10.9 years</div>
                </div>
            </a>
        </div>
    {% else %}
        <p style="color: #7f8c8d; text-align: center; padding: 20px;">No experience data available</p>
    {% endif %}
</div>

           <!-- Quick Actions -->
<div class="quick-actions" style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
    <h3 style="color: #2c3e50; margin-bottom: 15px;">ğŸš€ Quick Actions</h3>
    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
        {% if session.role in ['IQAC', 'Office', 'admin', 'editor', 'Admin', 'Editor'] %}
        <!-- IQAC/Office/Admin/Editor see these options -->
        <a href="/add_faculty" class="btn" style="background: #27ae60; color: white; padding: 12px 25px; text-decoration: none; border-radius: 8px; font-weight: bold; display: inline-flex; align-items: center; gap: 8px;">
            â• Add New Faculty
        </a>
        <a href="/faculty" class="btn" style="background: #3498db; color: white; padding: 12px 25px; text-decoration: none; border-radius: 8px; font-weight: bold; display: inline-flex; align-items: center; gap: 8px;">
            ğŸ‘¥ View All Faculty
        </a>
        <a href="/faculty?appointment_type=Regular" class="btn" style="background: #9b59b6; color: white; padding: 12px 25px; text-decoration: none; border-radius: 8px; font-weight: bold; display: inline-flex; align-items: center; gap: 8px;">
            âœ… View Regular Faculty
        </a>
        {% else %}
        <!-- Faculty role sees these options -->
        <a href="/faculty" class="btn" style="background: #3498db; color: white; padding: 12px 25px; text-decoration: none; border-radius: 8px; font-weight: bold; display: inline-flex; align-items: center; gap: 8px;">
            ğŸ‘¤ View My Profile
        </a>
        {% endif %}
    </div>
</div>
    <!-- Add some CSS for the stats grid -->
    <style>
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #3498db;
            margin-top: 10px;
        }
        .btn {
            display: inline-block;
            padding: 12px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        .btn-primary { background: #27ae60; }
        .btn-secondary { background: #7f8c8d; }
        .btn-info { background: #3498db; }
        .quick-actions {
            margin-top: 30px;
        }
        .quick-actions .btn {
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.quick-actions .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    border-color: #2c3e50;
}
    </style>
<!-- Add this JavaScript after your existing CSS -->
<script>
function checkAccess(type) {
    // For Faculty users, check if they have access to the selected category
    fetch('/check_faculty_access?type=' + type)
        .then(response => response.json())
        .then(data => {
            if (data.access_granted) {
                // Redirect to the appropriate page
                switch(type) {
                    case 'department':
                        window.location.href = '/department/' + encodeURIComponent(data.department);
                        break;
                    case 'designation':
                        window.location.href = '/designation/' + encodeURIComponent(data.designation);
                        break;
                    case 'experience':
                        window.location.href = '/experience/' + encodeURIComponent(data.experience_category);
                        break;
                }
            } else {
                // Show access denied message and redirect to their profile
                alert('âŒ Access Denied: ' + data.message);
                if (data.redirect_url) {
                    window.location.href = data.redirect_url;
                }
            }
        })
        .catch(error => {
            console.error('Error checking access:', error);
            alert('âŒ Error checking access. Please try again.');
        });
}

// Add click handlers to your designation cards
document.addEventListener('DOMContentLoaded', function() {
    // Make designation cards clickable with access control
    const designationCards = document.querySelectorAll('.designation-card');
    designationCards.forEach(card => {
        card.addEventListener('click', function() {
            const designation = this.getAttribute('data-designation');
            checkAccess('designation');
        });
    });
});
</script>    
{% endblock %}